<h1>メニュー編集</h1>

<%= form_with model: [:admin, @menu], local: true, multipart: true do |form| %>
  <% if @menu.errors.any? %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% @menu.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-6">
      <div class="mb-3">
        <%= form.label :name, "メニュー名", class: "form-label" %>
        <%= form.text_field :name, class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= form.label :shop_id, "ショップ", class: "form-label" %>
        <%= form.select :shop_id, options_from_collection_for_select(@shops, :id, :name, @menu.shop_id), 
                        { prompt: "ショップを選択してください" }, 
                        { class: "form-select" } %>
      </div>

      <div class="mb-3">
        <%= form.label :genre_id, "ジャンル", class: "form-label" %>
        <%= form.select :genre_id, options_from_collection_for_select(@genres, :id, :name, @menu.genre&.id), 
                        { prompt: "ジャンルを選択してください" }, 
                        { class: "form-select", required: true } %>
      </div>

      <div class="mb-3">
        <%= form.label :soup_id, "スープ", class: "form-label" %>
        <%= form.select :soup_id, options_from_collection_for_select(@soups, :id, :name, @menu.soup&.id), 
                        { prompt: "スープを選択してください" }, 
                        { class: "form-select", required: true } %>
      </div>

      <div class="mb-3">
        <%= form.label :noodle_id, "麺", class: "form-label" %>
        <%= form.select :noodle_id, options_from_collection_for_select(@noodles, :id, :name, @menu.noodle&.id), 
                        { prompt: "麺を選択してください" }, 
                        { class: "form-select", required: true } %>
      </div>
    </div>

    <div class="col-md-6">
      <div class="mb-3">
        <%= form.label :image, "メニュー画像", class: "form-label" %>
        
        <% if @menu.image.attached? %>
          <div class="mb-2">
            <strong>現在の画像:</strong><br>
            <%= image_tag @menu.image, class: "img-thumbnail mb-2", style: "max-width: 200px; max-height: 200px; object-fit: cover;" %>
          </div>
        <% end %>
        
        <%= form.file_field :image, class: "form-control", accept: "image/*" %>
        <div class="form-text">
          JPEGまたはPNG形式の画像をアップロードしてください
          <% if @menu.image.attached? %>
            <br>新しい画像を選択すると既存の画像が置き換わります
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-3">
    <%= form.submit "更新", class: "btn btn-primary" %>
    <%= link_to "詳細", admin_menu_path(@menu), class: "btn btn-secondary" %>
    <%= link_to "一覧", admin_menus_path, class: "btn btn-outline-secondary" %>
  </div>
<% end %>